<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Computers by Department - Admin</title>
  <link rel="stylesheet" href="/css/style.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
  <div class="page-wrapper">
    <!-- Header Section -->
    <header class="header">
      <div class="header-content">
        <div class="logo-section">
          <i class="fas fa-qrcode logo-icon"></i>
          <h1 class="logo-text">Admin Dashboard</h1>
        </div>
        <nav class="nav-menu">
          <a href="/admin" class="nav-link">
            <i class="fas fa-tachometer-alt"></i>
            <span>Dashboard</span>
          </a>
          <a href="/admin/computers" class="nav-link">
            <i class="fas fa-laptop"></i>
            <span>Manage Computers</span>
          </a>
          <a href="/admin/computers-by-department" class="nav-link active">
            <i class="fas fa-building"></i>
            <span>By Department</span>
          </a>
          <a href="/admin/add-computer" class="nav-link">
            <i class="fas fa-plus"></i>
            <span>Add Computer</span>
          </a>
          <a href="/computers" class="nav-link">
            <i class="fas fa-eye"></i>
            <span>View Public</span>
          </a>
          <a href="/admin/logout" class="nav-link" style="color: #dc2626;">
            <i class="fas fa-sign-out-alt"></i>
            <span>Logout</span>
          </a>
        </nav>
      </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
      <div class="container">
        <!-- Page Header -->
        <div class="page-header">
          <h2 class="page-title">
            <i class="fas fa-building"></i>
            Computers by Department
          </h2>
          <p class="page-subtitle">View and manage computers organized by department</p>
        </div>

        <!-- Department Summary -->
        <div class="department-summary">
          <div class="summary-stats">
            <div class="stat-item">
              <span class="stat-number"><%= departments.length %></span>
              <span class="stat-label">Departments</span>
            </div>
            <div class="stat-item">
              <span class="stat-number"><%= departments.reduce((total, dept) => total + dept.count, 0) %></span>
              <span class="stat-label">Total Computers</span>
            </div>
          </div>
        </div>

        <!-- Departments Grid -->
        <div class="departments-container">
          <% departments.forEach(department => { %>
            <div class="department-section">
              <div class="department-header">
                <h3 class="department-title">
                  <i class="fas fa-building"></i>
                  <%= department.department %>
                </h3>
                <span class="computer-count"><%= department.count %> computers</span>
              </div>
              
              <div class="computers-grid">
                <% if (computersByDepartment[department.department] && computersByDepartment[department.department].length > 0) { %>
                  <% computersByDepartment[department.department].forEach(computer => { %>
                    <div class="computer-card admin-card">
                      <div class="card-header">
                        <h4 class="computer-name">
                          <i class="fas fa-laptop"></i>
                          <%= computer.computer_name || `Computer ${computer.serial_number}` %>
                        </h4>
                        <div class="card-actions">
                          <a href="/generate-qr/<%= computer.id %>" class="btn btn-sm btn-secondary" title="Generate QR">
                            <i class="fas fa-qrcode"></i>
                          </a>
                          <button class="btn btn-sm btn-danger delete-btn" data-id="<%= computer.id %>" title="Delete">
                            <i class="fas fa-trash"></i>
                          </button>
                        </div>
                      </div>
                      
                      <div class="specs-grid">
                        <div class="spec-item">
                          <i class="fas fa-microchip"></i>
                          <div class="spec-content">
                            <span class="spec-label">CPU</span>
                            <span class="spec-value"><%= computer.cpu %></span>
                          </div>
                        </div>
                        
                        <div class="spec-item">
                          <i class="fas fa-memory"></i>
                          <div class="spec-content">
                            <span class="spec-label">RAM</span>
                            <span class="spec-value"><%= computer.ram %></span>
                          </div>
                        </div>
                        
                        <div class="spec-item">
                          <i class="fas fa-hdd"></i>
                          <div class="spec-content">
                            <span class="spec-label">Storage</span>
                            <span class="spec-value"><%= computer.storage %></span>
                          </div>
                        </div>
                        
                        <div class="spec-item">
                          <i class="fas fa-desktop"></i>
                          <div class="spec-content">
                            <span class="spec-label">GPU</span>
                            <span class="spec-value"><%= computer.gpu %></span>
                          </div>
                        </div>
                        
                        <div class="spec-item">
                          <i class="fab fa-windows"></i>
                          <div class="spec-content">
                            <span class="spec-label">OS</span>
                            <span class="spec-value"><%= computer.os %></span>
                          </div>
                        </div>
                        
                        <div class="spec-item">
                          <i class="fas fa-barcode"></i>
                          <div class="spec-content">
                            <span class="spec-label">Serial</span>
                            <span class="spec-value"><%= computer.serial_number %></span>
                          </div>
                        </div>
                        
                        <% if (computer.location) { %>
                          <div class="spec-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <div class="spec-content">
                              <span class="spec-label">Location</span>
                              <span class="spec-value"><%= computer.location %></span>
                            </div>
                          </div>
                        <% } %>
                        
                        <div class="spec-item">
                          <i class="fas fa-building"></i>
                          <div class="spec-content">
                            <span class="spec-label">Department</span>
                            <span class="spec-value"><%= computer.department %></span>
                          </div>
                        </div>
                      </div>
                      
                      <div class="card-footer">
                        <span class="created-date">
                          <i class="fas fa-calendar"></i>
                          <%= new Date(computer.created_at).toLocaleDateString() %>
                        </span>
                      </div>
                    </div>
                  <% }); %>
                <% } else { %>
                  <div class="empty-computers">
                    <i class="fas fa-laptop"></i>
                    <p>No computers in this department</p>
                  </div>
                <% } %>
              </div>
            </div>
          <% }); %>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <div class="footer-content">
        <p>&copy; 2024 Computer QR Generator - Admin Panel. All rights reserved.</p>
      </div>
    </footer>
  </div>

  <!-- Delete Confirmation Modal -->
  <div id="deleteModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Confirm Delete</h3>
        <span class="close">&times;</span>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete this computer? This action cannot be undone.</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="cancelDelete">Cancel</button>
        <button class="btn btn-danger" id="confirmDelete">Delete</button>
      </div>
    </div>
  </div>

  <script>
    // Delete functionality
    let computerToDelete = null;
    const modal = document.getElementById('deleteModal');
    const closeBtn = document.querySelector('.close');
    const cancelBtn = document.getElementById('cancelDelete');
    const confirmBtn = document.getElementById('confirmDelete');

    // Show modal
    document.querySelectorAll('.delete-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        computerToDelete = btn.dataset.id;
        modal.style.display = 'block';
      });
    });

    // Close modal
    closeBtn.addEventListener('click', () => {
      modal.style.display = 'none';
    });

    cancelBtn.addEventListener('click', () => {
      modal.style.display = 'none';
    });

    // Confirm delete
    confirmBtn.addEventListener('click', async () => {
      if (computerToDelete) {
        try {
          const response = await fetch(`/admin/computer/${computerToDelete}/delete`, {
            method: 'DELETE'
          });
          
          const result = await response.json();
          
          if (result.success) {
            // Remove the card from DOM
            const card = document.querySelector(`[data-id="${computerToDelete}"]`).closest('.computer-card');
            card.remove();
            
            // Update computer count
            const countElement = card.closest('.department-section').querySelector('.computer-count');
            const currentCount = parseInt(countElement.textContent);
            countElement.textContent = `${currentCount - 1} computers`;
            
            // Show success message
            alert('Computer deleted successfully!');
          } else {
            alert('Error deleting computer: ' + result.message);
          }
        } catch (error) {
          console.error('Error:', error);
          alert('Error deleting computer');
        }
      }
      
      modal.style.display = 'none';
    });

    // Close modal when clicking outside
    window.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.style.display = 'none';
      }
    });
  </script>
</body>
</html> 